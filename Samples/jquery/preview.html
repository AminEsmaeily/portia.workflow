<html encoding="UTF8">
    <header>
        <!--------------Required----------------->
        <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" href="node_modules/jquery-confirm/css/jquery-confirm.css">
        <!--------------------------------------->
        <link rel="stylesheet" href="../../designer/sequence/css/sequence.css">

        <link rel="stylesheet" href="node_modules/golden-layout/src/css/goldenlayout-base.css">
        <link rel="stylesheet" href="node_modules/golden-layout/src/css/goldenlayout-translucent-theme.css">
        <link rel="stylesheet" href="css/site.css">
    </header>
    <body>
    </body>

    <!------------------Required------------------>
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="node_modules/jquery-confirm/js/jquery-confirm.js"></script>
    <script src="node_modules/jquery-ui-dist/jquery-ui.min.js"></script>
    <script src="node_modules/jquery-ui-touch-punch-amd/jquery.ui.touch-punch.min.js"></script>
    <!-------------------------------------------->
    <script src="node_modules/esprima/dist/esprima.js"></script>

    <script src="../../designer/sequence/js/sequence.js"></script>

    <script src="node_modules/golden-layout/dist/goldenlayout.min.js"></script>

    <script>
        var seqDesigner;
        $(document).ready(function(){
            var config = {
                content : [{
                    type : 'row',
                    content : [{
                        type : 'column',
                        width : 15,
                        content : [{
                            type : 'component',
                            componentName : 'designer',
                            isClosable : false,
                            title : 'Toolbox',
                            componentState : { contentType : "toolbox" }
                        }]
                    },{
                        type : 'column',
                        content : [{
                            type : 'component',
                            componentName : 'designer',
                            isClosable : false,
                            title : 'Designer',
                            componentState : { contentType : "designer" }
                        },{
                            type : 'stack',
                            height : 30,
                            content : [{
                                type : 'component',
                                componentName : 'designer',
                                isClosable : false,
                                title : 'Variables',
                                componentState : { contentType : "variables" }
                            },{
                                type : 'component',
                                componentName : 'designer',
                                isClosable : false,
                                title : 'Log',
                                componentState : { contentType : "log" }
                            },{
                                type : 'component',
                                componentName : 'designer',
                                title : 'Output',
                                componentState : { contentType : "output" }
                            }]
                        }]
                    }]
                }]
            };

            var myLayout  = new GoldenLayout(config);

            var diagram = $('<div></div>').seqDesigner(
                {
                    hostControl : 'sequence',
                    drawGridLines : true,
                    customElements : [
                        {
                            title: 'Math Elements',
                            controls:[
                                {
                                    name: 'sum',
                                    title: 'Sum',
                                    icon: 'fa-plus',
                                    class: 'element-sum',
                                    constructor: function(){
                                        var element = diagram.getElementStructure('sum');
                                        var body = element.find('.panel-body').first();
                                        console.log(body);
                                        $('<input type="text"/>').appendTo($(body));
                                        return element;
                                    },
                                    validate: function(node){
                                        var dom = $(node);
                                        var errorList = [];
                                        return errorList;
                                    }
                                }
                            ]
                        }
                    ],
                    modelChanged : function(){
                        //$("#jsonStructure").jJsonViewer(diagram.getJSON());
                    },
                    selectedNodeChanged : function(item){
                        //$("#varTableContainer").empty();
                        //$("#varTableContainer").append(getVariablesTable(item));
                    }
                });

            myLayout.registerComponent('designer', function(container, componentState){
                if(componentState.contentType === "designer"){
                    container.getElement().html($("<div></div>")
                        .addClass("designerContainer")
                        .append(diagram.first()).first());
                }
                else if(componentState.contentType === "toolbox"){
                    container.getElement().html(getToolbox(diagram.getElements()));
                }
                else if(componentState.contentType === "output"){
                    //var outputPanel = getOutputPanel();
                    //container.getElement().html(outputPanel);
                }
                else if(componentState.contentType === "variables"){
                    //var outputPanel  = getVariablesPanel();
                    //container.getElement().html(outputPanel);
                }
            });
            myLayout.init();
        });

        var getToolbox = function(items){
            var container = $('<div></div>')
                .addClass('designerContainer');
            
            $.each(items, function(i, group){                        
                var ul = $('<ul></ul>')
                    .appendTo(container)
                    .css('padding', '0');
                var mainElement = $('<i></i>')
                    .append(group.title)
                    .appendTo(ul);

                for(var i = 0; i < group.controls.length; i++){
                    var li = $('<li></li>')
                                .addClass('list-group-item list-group-item-action list-group-item-info')
                                .addClass(group.controls[i].class)
                                .append($('<i style="margin-right:5px;"></i>')
                                            .addClass('fa ' + group.controls[i].icon))
                                .append(group.controls[i].title)
                                .appendTo(ul);

                    li.draggable(
                        {
                            appendTo: 'body',
                            containment: 'window',
                            scroll: false,
                            helper: 'clone'
                        });
                }
            });

            return container.css('padding', '5');
        }
    </script>
</html>